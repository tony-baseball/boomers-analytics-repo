---
output:
  pdf_document: 
    latex_engine: xelatex
    keep_tex: false
geometry: 
  - paperwidth=8.5in
  - paperheight=11in
  - margin=0.05in 
 
header-includes:
  \usepackage{fontspec}
  \setmainfont{Calibri}
  \usepackage{booktabs}
  \usepackage{colortbl}
  \usepackage{subfig}
  \usepackage{floatrow}
  \usepackage{sectsty}
  \usepackage{titlesec}
  \graphicspath{{C:/Users/tdmed/OneDrive/_Github/boomers-analytics/www}}
 

---
```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
#
library(DT)
# webshot::install_phantomjs()
library(webshot)
library(tidyverse)
library(kableExtra)
library(gridExtra)
library(gtsummary)
library(pak)
library(kableExtra)
library(knitr)
library(flextable)
library(pandoc)
library(ggplot2)
library(grDevices)
library(gridExtra)
opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.pos = '!h')
```

\begin{minipage}{0.2\textwidth}
\centering
\includegraphics[width=1.5cm, height=1.5cm]{`r params$team_logo`}
\end{minipage}
\hfill 
\begin{minipage}{0.5\textwidth}
\begin{center}
\textbf{\fontsize{24}{24}\selectfont `r params$hitter` - `r params$batter_side` }
\end{center}
\end{minipage}
\hfill
\begin{minipage}{0.2\textwidth}
\centering
\includegraphics[width=2.5cm, height=1.5cm]{fllogo2}
\end{minipage}

\vspace{-7mm} 

\begin{center}
\textbf{\normalsize Season Stats}
\end{center}
\vspace{-6mm} 
```{r game_summary_table and stats, echo=FALSE, warning=FALSE }

if (nrow(season_stats) > 0){
  kable(season_stats, format = "latex",  linesep = "") %>%
    kable_styling(latex_options = "HOLD_position", position = "center")%>%
    column_spec(1, bold = TRUE, border_left = TRUE) %>%
    row_spec(row = 0, color = "white",background = "#12294b", bold = TRUE) %>%
    column_spec(ncol(season_stats), border_right = TRUE)
} else{ "Stats Unavailable"}
```
\vspace{-9mm} 
\begin{center}
\textbf{\normalsize Performance `r params$szns`}
\end{center}
\vspace{-6mm} 
```{r perf_splits,warning=FALSE,echo=FALSE,include=TRUE}

kable(splits, format = "latex",  linesep = "") %>%
  kable_styling(latex_options = "HOLD_position", position = "center")%>%
  column_spec(1, bold = TRUE, border_left = TRUE) %>%
  row_spec(row = 0, color = "white",background = "#12294b", bold = TRUE) %>%
  column_spec(ncol(splits), border_right = TRUE)
```
\vspace{-9mm} 
\begin{center}
\textbf{\normalsize Batted Ball Data `r params$szns`}
\end{center}
\vspace{-6mm} 
```{r battedball,warning=FALSE,echo=FALSE,include=TRUE}

kable(bat_v_p_bip, format = "latex",  linesep = "") %>%
  kable_styling(latex_options = "HOLD_position", position = "center")%>%
  column_spec(1, bold = TRUE, border_left = TRUE) %>%
  row_spec(row = 0, color = "white",background = "#12294b", bold = TRUE) %>%
  column_spec(ncol(bat_v_p_bip), border_right = TRUE)
```


```{r disc,warning=FALSE,echo=FALSE,include=TRUE, include=F}
# \vspace{-9mm} 
# \begin{center}
# \textbf{\normalsize Batter Discipline `r params$szns`}
# \end{center}
# \vspace{-7mm} 
kable(bat_v_p_disc, format = "latex",  linesep = "") %>%
  kable_styling(latex_options = "HOLD_position", position = "center")%>%
  column_spec(1, bold = TRUE, border_left = TRUE) %>%
  row_spec(row = 0, color = "white",background = "#12294b", bold = TRUE) %>%
  column_spec(ncol(bat_v_p_disc), border_right = TRUE)
```
\vspace{-9mm} 

\begin{center}
\begin{minipage}[t]{0.4\textwidth}
\centering
\textbf{\normalsize vs RHP `r params$szns`}
\end{minipage}
\hfill
\begin{minipage}[t]{0.5\textwidth}
\centering
\textbf{\normalsize vs LHP `r params$szns`}
\end{minipage}
\end{center}
\vspace{-7mm} 

```{r Vs R & L,echo=FALSE,warning=FALSE }

knitr::kables(
  list(
    # the first kable() to change column names
    if(nrow(pitch_vs_rhp) >0){
      knitr::kable(
        pitch_vs_rhp, valign = 't', label = 'Pitch Usage'
      ) %>%
        column_spec(1, bold = TRUE, border_left =  TRUE#,
             
        )%>%
        row_spec(row = 0, color = "white",background = "#12294b", bold = TRUE) %>%
        column_spec(ncol(pitch_vs_rhp), border_right = TRUE)
    }
    else if (nrow(pitch_vs_rhp) == 0) {
      # Create a placeholder message if there is no data
      kable(data.frame(Message = "No Pitch or Batted Ball Data Available vs Right Handed Pitchers"), valign = 't',  format = "latex", linesep = "") %>%
        # kable_styling(latex_options = "HOLD_position", position = "center") %>%
        column_spec(1, border_left = TRUE) %>%
        row_spec(row = 0, color = "white", background = "#12294b") 
    } ,
    
    if(nrow(pitch_vs_lhp) >0){
      # the second kable() to set the digits option
      knitr::kable(pitch_vs_lhp,  valign = 't', label = 'Batted Ball') %>%
        column_spec(1, bold = TRUE, border_left =  TRUE#, 
        )%>%
        row_spec(row = 0, color = "white",background = "#12294b", bold = TRUE) %>%
        column_spec(ncol(pitch_vs_lhp), border_right = TRUE) 
      
    }  else if (nrow(pitch_vs_lhp) == 0) {
      
      # Create a placeholder message if there is no data
      kable(data.frame(Message = "No Pitch or Batted Ball Data Available vs Left Handed Pitchers"),valign = 't',format = "latex", linesep = "") %>%
        # kable_styling(latex_options = "HOLD_position", position = "center") %>%
        column_spec(1, border_left = TRUE) %>%
        row_spec(row = 0, color = "white", background = "#12294b") 
    } 
  ), 
  format = "latex" )    %>%
  kable_styling(latex_options = "HOLD_position")

```
\vspace{-6mm} 

```{r EV_zone_opp, echo=FALSE, warning=FALSE, fig.width=1.7, fig.height=2.7, include = TRUE} 
EV_zone_opp
avg_by_zone
slg_by_zone
hh_opp
# sw_opp
# wh_opp
whiff_opp
```
\vspace{-12mm} 

\begin{center}
\begin{minipage}[t]{0.4\textwidth}
\centering
\textbf{\normalsize Infield Batted Balls `r params$szns`}
\end{minipage}
\hfill
\begin{minipage}[t]{0.5\textwidth}
\centering
\textbf{\normalsize Outfield Batted Balls `r params$szns`}
\end{minipage}
\end{center}

\vspace{-5mm} 

```{r spray_heat_opp, echo=FALSE, warning=FALSE,fig.height = 4,fig.width=4.2, position= 'center'} 
if_spray_plot
of_spray_plot
```

\vspace{-8mm} 


